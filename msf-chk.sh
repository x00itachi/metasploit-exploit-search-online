#!/bin/sh

source ./config
source ./functions.lib

if [[ -n "$ref" ]]; then
	trimref=`echo $ref | sed -r 's/(\s*)//gi'`
	refsource=`echo $trimref | cut -d"-" -f1`
	if [[ `echo $refsource | tr [:lower:] [:upper:]` == "CVE" ]]; then
		curl -s "$msfrefpage?cve=$trimref" >$srchrespage
		getref
	elif [[ `echo $refsource | tr [:lower:] [:upper:]` == "BID" ]]; then
		curl -s "$msfrefpage?bid=`echo $trimref | cut -d"-" -f2`" >$srchrespage
		getref
	elif [[ `echo $refsource | tr [:lower:] [:upper:]` == "OSVDB" ]]; then
		curl -s "$msfrefpage?osvdb=`echo $trimref | cut -d"-" -f2`" >$srchrespage
		getref
	elif [[ `echo $refsource | tr [:lower:] [:upper:]` == "MSB" ]]; then
		curl -s "$msfrefpage?msb=`echo $trimref | sed 's/MSB-//'`" >$srchrespage
		getref
	else usage
	fi
else usage
fi

rm -rf $srchrespage
rm -rf $tmp1
