
function getref {
        page=`cat srchrespage`
		noresults="No results matched your query"
		srchresults="Search Results"
		count=1
		exploitscount=1
		
        if [[ $page =~ $noresults ]]; then
                echo "No exploit found"
				
		elif [[ $page =~ $srchresults  ]]; then
			cat srchrespage | grep -i "resultbox" -A 1 | grep -i "href" | cut -d"\"" -f2 >tmp
			exploitscount=`cat tmp | wc -l`
			for urlparsed in `cat tmp`
			do
				url="$metasploit$urlparsed"
				curl -s $url >srchrespage
				[[ $output == "csv" ]] && exploitname || printref
				count=$(($count+1))
			done
			
        else
			url=`cat srchrespage | cut -d"\"" -f2`
			curl -s $url >srchrespage
			[[ $output == "csv" ]] && exploitname || printref 
	fi
}

function printref {
        echo -e "\n[$count/$exploitscount]Reference :"
        echo "==============="
        cat srchrespage | grep -i "Vulnerability References" -A 10 | grep -i "href" | awk -F\> '{print $3}' | cut -d\< -f1
        echo -e "\n[$count/$exploitscount]Usage Information :"
        echo "======================="
        cat srchrespage | grep -i "usage information" -A 20 | grep msf | sed '/<div/ d' | sed 's/&gt;/\>/g' | sed -r 's/<\/?b(r\/)?>//g'
}

function downloadexploit {
	echo -e "\ndownload Exploit"
	exploit=`curl -s \`cat $srchrespage | grep -i ">Source Code<" | cut -d"\"" -f4\` | grep -i ">Download<" | cut -d"\"" -f2`
	echo "$devmsf$exploit"
	#echo -e "\nExploit page"
	#cat $srchrespage |grep -i "Development" -A 10
}

function usage {
	echo -e "USAGE:$0 <reference>\nEg: $0 CVE-2007-4387\nEg: $0 BID-36075\nEg: $0 OSVDB-2345\nEg: $0 MSB-MS10-13"
}

function exploitname {
		exploit=`cat srchrespage | grep "msf" | sed 's/&gt;/\>/g' | sed -r 's/<\/?b(r\/)?>//g' | grep -i " use " | cut -d" " -f4`
		echo "$trimref,$exploit"
}